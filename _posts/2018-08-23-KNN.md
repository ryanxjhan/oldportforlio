---
layout: mypost
title: Introduction to KNN 
categories: [KNN]
---

### Import


```python
import pandas as pd
import matplotlib.pyplot as plt
import numpy as np 
import warnings
warnings.filterwarnings('ignore')
```

### Load Data

We select only a portion of the entire data to reduce the running time.


```python
data = pd.read_csv('input/train.csv')
train_row = 5000 
x_train = data.values[0:train_row, 1:]
y_train = data.values[0:train_row, 0]
test = pd.read_csv('input/test.csv')
```

### First Glance of the Data


```python
data.shape
```




    (42000, 785)




```python
data.columns
```




    Index(['label', 'pixel0', 'pixel1', 'pixel2', 'pixel3', 'pixel4', 'pixel5',
           'pixel6', 'pixel7', 'pixel8',
           ...
           'pixel774', 'pixel775', 'pixel776', 'pixel777', 'pixel778', 'pixel779',
           'pixel780', 'pixel781', 'pixel782', 'pixel783'],
          dtype='object', length=785)




```python
data.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>label</th>
      <th>pixel0</th>
      <th>pixel1</th>
      <th>pixel2</th>
      <th>pixel3</th>
      <th>pixel4</th>
      <th>pixel5</th>
      <th>pixel6</th>
      <th>pixel7</th>
      <th>pixel8</th>
      <th>...</th>
      <th>pixel774</th>
      <th>pixel775</th>
      <th>pixel776</th>
      <th>pixel777</th>
      <th>pixel778</th>
      <th>pixel779</th>
      <th>pixel780</th>
      <th>pixel781</th>
      <th>pixel782</th>
      <th>pixel783</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows Ã— 785 columns</p>
</div>



### Display a Image


```python
row = 3
plt.imshow(x_train[3].reshape(28,28))
```




    <matplotlib.image.AxesImage at 0x1128139b0>




![png](knn_files/knn_10_1.png)


### Display some Images


```python
for cls in range(10):
    idx = list(data.label).index(cls)
    plt.subplot(1, 10, cls+1)
    plt.imshow(x_train[idx].reshape(28,28))
    plt.axis('off')
```


![png](knn_files/knn_12_0.png)


### Split Data into Training and Testing


```python
from sklearn.model_selection import train_test_split
x_train_split, x_vali, y_train_split, y_vali = train_test_split(x_train,
                                                   y_train,
                                                   test_size = 0.2,
                                                   random_state = 0)
```


```python
print(x_train.shape, x_vali.shape)
```

    (5000, 784) (1000, 784)


### Find the Best K


```python
import time
from sklearn.metrics import accuracy_score,classification_report,confusion_matrix
from sklearn.neighbors import KNeighborsClassifier

scores = []

for k in range(1,8):
    print('when k = ' + str(k) + '...')
    start = time.time()
    knn = KNeighborsClassifier(n_neighbors=k)
    knn.fit(x_train_split, y_train_split)
    pred = knn.predict(x_vali)
    score = accuracy_score(y_vali, pred)
    scores.append(score)
    end = time.time()
    print('accuracy is ' + str(score))
    print('time: ' + str(end-start) + 's')
    
```

    when k = 1...
    accuracy is 0.919
    time: 5.8991522789001465s
    when k = 2...
    accuracy is 0.906
    time: 5.916143178939819s
    when k = 3...
    accuracy is 0.92
    time: 5.870412111282349s
    when k = 4...
    accuracy is 0.915
    time: 6.353905916213989s
    when k = 5...
    accuracy is 0.915
    time: 5.946413040161133s
    when k = 6...
    accuracy is 0.914
    time: 6.045928955078125s
    when k = 7...
    accuracy is 0.915
    time: 6.477211952209473s



```python
plt.plot(range(1,8),scores)
plt.xlabel('k')
plt.ylabel('score')
best_k = scores.index(max(scores)) + 1
```


![png](knn_files/knn_18_0.png)


### Predict


```python
knn = KNeighborsClassifier(n_neighbors=best_k)
knn.fit(x_train, y_train)
test_pred = knn.predict(test[:300])
```


```python
print(test_pred[0])
plt.imshow(test.values[0].reshape(28,28))
```

    2





    <matplotlib.image.AxesImage at 0x123887588>




![png](knn_files/knn_21_2.png)


### Output


```python
print(len(test_pred))
pd.DataFrame({"ImageId": list(range(1,len(test_pred)+1)),"Label": test_pred}).to_csv('submission.csv', index=False,header=True)

```

    300

